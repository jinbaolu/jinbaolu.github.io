(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{430:function(t,a,v){"use strict";v.r(a);var s=v(29),i=Object(s.a)({},(function(){var t=this,a=t.$createElement,v=t._self._c||a;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"h5-兼容性总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#h5-兼容性总结"}},[t._v("#")]),t._v(" H5 兼容性总结")]),t._v(" "),v("h2",{attrs:{id:"背景"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),v("ol",[v("li",[t._v("客户使用签署页面时，在不同的机型、系统、浏览器上，展现不一致的问题")]),t._v(" "),v("li",[t._v("手机浏览器的内存比较小，对页面的性能要求比较高")]),t._v(" "),v("li",[t._v("手机分辨率不一样，同一个 UI 稿适应不同手机分辨率")])]),t._v(" "),v("h2",{attrs:{id:"适配范围"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#适配范围"}},[t._v("#")]),t._v(" 适配范围")]),t._v(" "),v("p",[t._v("产品提供需要适配的范围")]),t._v(" "),v("h2",{attrs:{id:"方案"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#方案"}},[t._v("#")]),t._v(" 方案")]),t._v(" "),v("ol",[v("li",[t._v("HTML")])]),t._v(" "),v("p",[t._v("结构合理，DOM 节点层级不易过深")]),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[t._v("CSS")])]),t._v(" "),v("p",[t._v("使用比较新的 CSS 属性时，注意该属性支持的范围（https://caniuse.com/看到支持范围），在支持范围以外，应做向后兼容的方案")]),t._v(" "),v("ol",{attrs:{start:"3"}},[v("li",[t._v("JS")])]),t._v(" "),v("ul",[v("li",[t._v("精简 JS 等")]),t._v(" "),v("li",[t._v("在组件传值的时候，建议一层一层传递 props，不建议使用$attrs、$listeners；")]),t._v(" "),v("li",[t._v("利用生命周期，在组件卸载前后，清除一些数据、事件等")])]),t._v(" "),v("h2",{attrs:{id:"实践过的方案"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#实践过的方案"}},[t._v("#")]),t._v(" 实践过的方案")]),t._v(" "),v("ol",[v("li",[t._v("优化 HTML 结构，减少 DOM 节点层级")]),t._v(" "),v("li",[t._v("去除$attrs、$listeners，可以提高性能，注意 props 要接受，不然容易造成浏览器奔溃")]),t._v(" "),v("li",[t._v("在组件卸载前，释放 canvas 内存")])]),t._v(" "),v("h2",{attrs:{id:"bug"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#bug"}},[t._v("#")]),t._v(" BUG")]),t._v(" "),v("ol",[v("li",[t._v("canvas 相关")])]),t._v(" "),v("ul",[v("li",[v("p",[t._v("在 ios 系统上，文档切换多次之后会导致 pdf 渲染不出来；因为在切换文档的时候，canvas dom 节点已经卸载，但是内存并没有释放，使用 canvas.width = 0; canvas.heigth = 0; 来手动释放内存")])]),t._v(" "),v("li",[v("p",[t._v("单个 canvas 太大在 ios 上会显示不了，减小单个 canvas 大小")])]),t._v(" "),v("li",[v("p",[t._v("canvas.toBlob 的方法在 uc 上支持性不好，移动端不用图片展示 pdf。canvas.toDataURL vs toBlob(https://www.zhihu.com/question/59267048) toDataURL 结果比 toBlob 占用更多的内存")])]),t._v(" "),v("li",[v("p",[t._v("移动端 canvas 宽度要刚好占满整个屏幕的时候，不要写 css：width:100%; 要写 transform:scale。写 width:100%还会导致 canvas 模糊 (https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas）")])]),t._v(" "),v("li",[v("p",[t._v("canvas 黑屏也是因为 canvas 占内存太多")])]),t._v(" "),v("li",[v("p",[t._v("移动端 canvas 写在 template 里面会导致宽高显示有问题。可以动态生成插入")])]),t._v(" "),v("li",[v("p",[t._v("pdf 内容部分重叠 ，因 canvas 的 height 和样式中的 height 不一致导致，删除样式中的 height")])]),t._v(" "),v("li",[v("p",[t._v("bug 未发现原因：ios 11 系统上，网易入职文档中的第二页不显示，需要通过缩放显示；发现给 page 添加 transform: scale(1)就能把文档展示出来，或者一开始就给 page 通过 css 设置一个固定高度覆盖 style 上后面计算的高度，不知道是什么原因，感觉和视图更新有关。")])])]),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[t._v("css 问题")])]),t._v(" "),v("ul",[v("li",[t._v("display:flex 在部分 android 浏览器上支持性不好。")]),t._v(" "),v("li",[t._v("1px 问题： transform:scale(0.5)")]),t._v(" "),v("li",[t._v("border 兼容性问题，iphone xs 上 div 的 border 只显示了其中两边或三边，原因是 border 不支持 rem, 改 px 没问题。")]),t._v(" "),v("li",[t._v("部分安卓下 border-radius: 50%，并不圆; 改 px。")]),t._v(" "),v("li",[t._v("魅族自带浏览器，pdf-bar 组件 fix 定位被浏览器操作栏挡住。fix 改 absolute")]),t._v(" "),v("li",[t._v("骑缝章背景图 background-size: 100%/cover/contain 未能填充满整个 div。")]),t._v(" "),v("li",[t._v("多写禁止选中文本，更有原生感觉：user-select: none;")])]),t._v(" "),v("ol",{attrs:{start:"3"}},[v("li",[t._v("js")])]),t._v(" "),v("ul",[v("li",[t._v("往返缓存问题 bfcache: 点击浏览器返回时候不自动刷新页面，特别是 mobile safari(https://segmentfault.com/a/1190000015321895)")]),t._v(" "),v("li",[t._v("荣耀 8x 下编辑和删除按钮点的 touchstart 事件没触发，touchend 触发了。ios10 下编辑和删除按钮点 touchstart 和 touchend 都没触发。后改为 click 事件，有 300ms 延迟。")]),t._v(" "),v("li",[t._v("内存优化： 清理 Detached HtmlDivElement/减少子元素监听器，放在父元素上，特别是不要给每个子元素都创建一个 alloyFinger 实例")]),t._v(" "),v("li",[t._v("video: 视频编码的问题导致 video 无法展示/可用 video.js 处理")])]),t._v(" "),v("ol",{attrs:{start:"4"}},[v("li",[t._v("html")])]),t._v(" "),v("ul",[v("li",[t._v('移动端点 input 框输入，页面被放大。可设置禁止缩放 viewport: <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">')]),t._v(" "),v("li",[t._v("ios11 及以下不支持下载，部分 ios 不支持 window.open，下载可用 a 标签")])]),t._v(" "),v("ol",{attrs:{start:"5"}},[v("li",[t._v("vue")])]),t._v(" "),v("ul",[v("li",[t._v("印章拖拽边缘判断不准确，dom 元素获取不能放 computed 计算，当属性没有发生改变的时候，当前变量的值会从缓存中读取，导致位置计算不准确。可以放到 mounted")])])])}),[],!1,null,null,null);a.default=i.exports}}]);